<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <title>Nintendo 64</title>
    <link
      rel="icon"
      sizes="16x16"
      type="image/png"
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAABmJLR0QA/wD/AP+gvaeTAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH5gYFBCM0LEN8pQAAApJJREFUOMudk21ojWEYx3/38zznOW+mDW2JEJolDRs6mpWyZeiYLV+kTGKJ5S1v+eTDSmpfhDZvSbEPlo6atyyljFl2jEhiJbaRl0gnO855nnNfPuycQzNf/L9cV13X9f9f1//uVvwnvlUuKVFIygotb+kHjgHzgXLgCrAauAv8ANYBTSi1AZGIRlUvl74blnTOdjH8BtCbHhbgDWADj1LaiMYdTyqlVRewABENOAZiXlezBnM6usJ5Hfcr/rmiCH55OmWfCAWjNlTdHo5H25b+VSs4ubZi26VKuRcpl8b9u6Rs5alFI3vOH9kIgAJoaK2ceHxafxPKXEbcOTDl9ZwmrycxwdsWloBrqe99hYXt53bML7QTjQTib689WLgn3ND2LEswo7l2u9ejT5x5/UlKb6fU7lW53Bgq1pVfcqXn3WTTqbjXHhv/NVzm/0ns6goGYsGzT+5s2gJgAXiUOK6r2D4pX3rN96qud0iXNXTJ+oIB8/mLQl33akbYtVyisTEy7nuO8nmTycwpViYxgG8Bw2idHdTFnx2160O+cagjRF602Agamnj1LcFyUUqQP7ww/jTGpzWNi3OV3xXxKSHPThKwk7heh7F3yhGP+5fhWQIxNb6+aTppa3WiJEc8elgnhcF0/VU7iYAKdpcIZmp0ApTGfjMVO+anfabf9KbFHGVSn+g25sqgGAOTDDH1qAQmgHgcI9gzD0u56fcBS1JErcmXm+MRFVCJzP3eLEFRSw0vt0aaxeOGxJs83HPxoFKu1f/bZc0FuzTi64yqnYnOg0PKXvPwVv3mUNXp4bpWUNRSw8u6SDfc7E7PVQOPSX+QMZL4CFB7t/UotBKqaia74kgUtdRk87l796zK5BnFkfgFfgsEm65tUdsAAAAASUVORK5CYII="
    >
    <meta name="theme-color" content="#000">
    <meta name="description" content="JavaScript Nintendo 64 Emulator.">
    <meta name="keywords" content="javascript, nintendo64, emulator">
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, minimum-scale=1.0"
    >
    <style>
      html,body{padding:0;margin:0;overscroll-behavior:none;background-color:#000;touch-action:none;user-select:none;-moz-user-select:none;-webkit-user-select:none;-webkit-tap-highlight-color:transparent}

      #container{display:none}
      input[type=file]{display:none}
      #email{position:fixed;right:0;bottom:0;padding-right:15px;line-height:3.2;font-family:Arial;font-size:16px;color:#fff;user-select:none;-webkit-user-select:none}
      #email a{text-decoration:none;color:#fff;background-color:transparent;border:0;outline:0}
      #email a:focus{text-decoration: none; outline:1px solid #fff}
      #demo-loader{display:none;position:fixed;left:0;bottom:0;right:0;top:0;width:20vw;height:20vw;margin:auto auto;cursor:pointer;background-color:transparent;border:0;outline:0}
      #demo-loader:focus{outline:1px solid #fff}
      #demo-loader:hover{filter:brightness(110%)}
      #file-selector{display:none;position:fixed;left:0;bottom:0;right:0;top:0;width:20vw;height:20vw;margin:auto auto;cursor:pointer;background-color:transparent;border:0;outline:0}
      #file-selector:focus{outline:1px solid #fff}
      #file-selector:hover{filter:brightness(110%)}

      #game{width:100vw;height:100vh}

      .pleasewait{position:fixed;width:64px;height:64px;left:0;right:0;top:0;bottom:0;margin:auto auto;border:0}
      .lds-spinner{color:#fff;display:inline-block;position:relative;width:64px;height:64px}
      .lds-spinner div{transform-origin:32px 32px;animation:lds-spinner 1.2s linear infinite}
      .lds-spinner div:after{content:" ";display:block;position:absolute;top:3px;left:29px;width:5px;height:14px;border-radius:20%;background:#fff}
      .lds-spinner div:nth-child(1){transform:rotate(0deg);animation-delay:-1.1s}
      .lds-spinner div:nth-child(2){transform:rotate(30deg);animation-delay:-1s}
      .lds-spinner div:nth-child(3){transform:rotate(60deg);animation-delay:-.9s}
      .lds-spinner div:nth-child(4){transform:rotate(90deg);animation-delay:-.8s}
      .lds-spinner div:nth-child(5){transform:rotate(120deg);animation-delay:-.7s}
      .lds-spinner div:nth-child(6){transform:rotate(150deg);animation-delay:-.6s}
      .lds-spinner div:nth-child(7){transform:rotate(180deg);animation-delay:-.5s}
      .lds-spinner div:nth-child(8){transform:rotate(210deg);animation-delay:-.4s}
      .lds-spinner div:nth-child(9){transform:rotate(240deg);animation-delay:-.3s}
      .lds-spinner div:nth-child(10){transform:rotate(270deg);animation-delay:-.2s}
      .lds-spinner div:nth-child(11){transform:rotate(300deg);animation-delay:-.1s}
      .lds-spinner div:nth-child(12){transform:rotate(330deg);animation-delay:0s}
      @keyframes lds-spinner{0%{opacity:1}to{opacity:0}}
    </style>
  </head>
  <body>
    <div id="game"></div>
    <div class="pleasewait">
      <div class="lds-spinner">
        <div></div>
        <div></div>
        <div></div>
        <div></div>
        <div></div>
        <div></div>
        <div></div>
        <div></div>
        <div></div>
        <div></div>
        <div></div>
        <div></div>
      </div>
    </div>
    <div id="container">
      <div id="email"><a href="mailto:info@lrusso.com">info@lrusso.com</a></div>
      <button id="demo-loader">
        <svg width="100%" height="100%" viewBox="0 0 502 502">
          <circle fill="#FFF" cx="250" cy="250" r="200" />
          <path
            fill="#b9180b"
            d="M251,1C112.929,1,1,112.929,1,251s111.929,250,250,250s250-111.929,250-250S389.071,1,251,1z M164.75,366  V136l230,115L164.75,366z"
          />
        </svg>
      </button>
      <button id="file-selector">
        <svg width="100%" height="100%" viewBox="0 0 502 502">
          <circle fill="#FFF" cx="250" cy="250" r="200" />
          <path
            fill="#b9180b"
            d="M251,1C112.929,1,1,112.929,1,251s111.929,250,250,250s250-111.929,250-250S389.071,1,251,1z   M251.283,111.853L351,236.738h-56.935v73.761H208.51v-73.761h-56.941L251.283,111.853z M208.51,336.122v-19.418h85.556v19.418  H208.51z M294.065,341.665v10.186H208.51v-10.186H294.065z M391,380.147c0,5.522-4.477,10-10,10H121c-5.523,0-10-4.478-10-10  v-72.935c0-5.743,4.643-10.399,10.37-10.399s10.37,4.656,10.37,10.399v62.194h238.52v-62.194c0-5.743,4.643-10.399,10.37-10.399  S391,301.47,391,307.213V380.147z"
          />
        </svg>
      </button>
      <input
        type="file"
        id="romfile-input"
        accept=".n64,.z64,application/octet-stream"
      >
    </div>
    <script src="Nintendo64.js"></script>
    <script>
      var container = document.getElementById("container")
      var demoLoader = document.getElementById("demo-loader")
      var fileSelector = document.getElementById("file-selector")
      var romFileInput = document.getElementById("romfile-input")
      var pleaseWait = document.querySelector(".pleasewait")

      window.addEventListener("load", function () {
        if (window.top === window.self) {
          container.style.display = "block"

          var currentURL = new URL(window.location.href).searchParams
          var demoRequired = currentURL.has("demo")

          if (demoRequired) {
            demoLoader.style.display = "block"
            demoLoader.tabIndex = 1
          } else {
            fileSelector.style.display = "block"
            fileSelector.tabIndex = 1
          }

          demoLoader.addEventListener("click", function () {
            container.style.display = "none"

            // the game url can be full or relative.
            // if full, the emulator will get the filename from it.
            var gameURL = "DEMO.n64"

            // no fetch here because the entire project
            // is compatible with pre 2015 environments.
            var xhr = new XMLHttpRequest()
            xhr.open("GET", gameURL, true)
            xhr.responseType = "arraybuffer"
            xhr.onreadystatechange = function () {
              if (xhr.readyState === 4 && xhr.status === 200) {
                embedNintendo64({
                  container: "game",
                  name: gameURL,
                  rom: xhr.response,
                  player1: {
                    analogUp: "ArrowUp",
                    analogDown: "ArrowDown",
                    analogLeft: "ArrowLeft",
                    analogRight: "ArrowRight",
                    actionUp: "i",
                    actionDown: "k",
                    actionLeft: "j",
                    actionRight: "l",
                    up: "t",
                    down: "g",
                    left: "f",
                    right: "h",
                    start: "Enter",
                    a: "d",
                    b: "s",
                    r: "w",
                    z: "a",
                    l: "q",
                  },
                  cbStarted: function cbStarted() {
                    pleaseWait.style.display = "none"
                  },
                })
              }
            }

            xhr.send(null)
          })

          fileSelector.addEventListener("click", function () {
            demoLoader.blur()
            fileSelector.blur()
            romFileInput.click()
          })

          romFileInput.addEventListener("change", function (event) {
            var validExtensions = [".n64", ".z64"]
            var fileExtension = event.target.files[0].name.toLowerCase()
            var isValid = false

            for (var i = 0; i < validExtensions.length; i++) {
              if (fileExtension.endsWith(validExtensions[i])) {
                isValid = true
                break
              }
            }

            if (!isValid) {
              romFileInput.value = null
              return
            }

            container.style.display = "none"

            var filereader = new FileReader()
            filereader.onload = function () {
              embedNintendo64({
                container: "game",
                name: event.target.files[0].name,
                rom: filereader.result,
                player1: {
                  analogUp: "ArrowUp",
                  analogDown: "ArrowDown",
                  analogLeft: "ArrowLeft",
                  analogRight: "ArrowRight",
                  actionUp: "i",
                  actionDown: "k",
                  actionLeft: "j",
                  actionRight: "l",
                  up: "t",
                  down: "g",
                  left: "f",
                  right: "h",
                  start: "Enter",
                  a: "d",
                  b: "s",
                  r: "w",
                  z: "a",
                  l: "q",
                },
                cbStarted: function cbStarted() {
                  pleaseWait.style.display = "none"
                  romFileInput.value = null
                },
              })
            }

            filereader.readAsArrayBuffer(event.target.files[0])
          })

          document.addEventListener("keydown", function (event) {
            var KEY_CTRL = event.ctrlKey || event.metaKey
            var KEY_1 = event.code === "Digit1"
            var KEY_2 = event.code === "Digit2"
            var KEY_3 = event.code === "Digit3"
            var KEY_F = event.code === "KeyF"

            if (KEY_CTRL && KEY_1) {
              event.preventDefault()
              downloadStateNintendo64()
            }

            if (KEY_CTRL && KEY_2) {
              event.preventDefault()
              uploadStateNintendo64()
            }

            if (KEY_CTRL && KEY_3) {
              event.preventDefault()
              toggleSoundNintendo64()
            }

            if (KEY_CTRL && KEY_F) {
              event.preventDefault()
              requestEmulatorFullscreenNintendo64()
            }
          })
        }
      })
    </script>
  </body>
</html>
